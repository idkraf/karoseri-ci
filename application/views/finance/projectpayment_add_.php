<div class="wrapper">
            <nav class="main-header navbar navbar-expand navbar-dark navbar-light small">
    <h4 class="text-yellow ml-2">GRAGE KAROSERI (CV)</h4>
    
    <ul id="box_usermodule" class="navbar-nav">
        <li class="nav-item">
            <a type="button" class="nav-link" onclick="logoutClick()" title="Logout ?">
                <i class="fa fa-power-off ml-2"></i>
            </a>
        </li>
    <li class="nav-item dropdown"><a title="User" class="nav-link" data-toggle="dropdown" href="#"><i class="fa fa-user"></i></a><div class="dropdown-menu"><div class="pl-2 text-bold">User</div><div class="dropdown-divider"></div><a class="dropdown-item small" href="/user">01. Home</a><a class="dropdown-item small" href="/user/profile">02. Profile</a><div class="dropdown-divider"></div><a class="dropdown-item small" href="/user/changepassword">03. Change Password</a><a class="dropdown-item small" href="/user/changepin">04. Change Pin</a></div></li><li class="nav-item dropdown"><a title="Sys" class="nav-link" data-toggle="dropdown" href="#"><i class="fa fa-anchor"></i></a><div class="dropdown-menu"><div class="pl-2 text-bold">Sys</div><div class="dropdown-divider"></div><a class="dropdown-item small" href="/sys/module">01. Module</a></div></li><li class="nav-item dropdown"><a title="Setup" class="nav-link" data-toggle="dropdown" href="#"><i class="fa fa-atom"></i></a><div class="dropdown-menu"><div class="pl-2 text-bold">Setup</div><div class="dropdown-divider"></div><a class="dropdown-item small" href="/setup/user">01. User</a></div></li><li class="nav-item dropdown"><a title="Operation" class="nav-link" data-toggle="dropdown" href="#"><i class="fa fa-archive"></i></a><div class="dropdown-menu"><div class="pl-2 text-bold">Operation</div><div class="dropdown-divider"></div><a class="dropdown-item small" href="/operation/purchase">01. Purchase</a><a class="dropdown-item small" href="/operation/purchasepayment">02. Purchase Payment</a><a class="dropdown-item small" href="/operation/receive">03. Stock In</a><a class="dropdown-item small" href="/operation/return">04. Return</a><div class="dropdown-divider"></div><a class="dropdown-item small" href="/operation/project">05. Project</a><a class="dropdown-item small" href="/operation/projectpayment">06. Project Payment</a><a class="dropdown-item small" href="/operation/projectdelivery">07. Stock Out</a><a class="dropdown-item small" href="/operation/projectstaffpayment">08. Staff</a><div class="dropdown-divider"></div><a class="dropdown-item small" href="/operation/cashbond">09. Cashbond</a><a class="dropdown-item small" href="/operation/cashbondpayment">10. Cashbond Payment</a><div class="dropdown-divider"></div><a class="dropdown-item small" href="/operation/opname">11. Opname</a></div></li><li class="nav-item dropdown"><a title="Accounting" class="nav-link" data-toggle="dropdown" href="#"><i class="fa fa-balance-scale"></i></a><div class="dropdown-menu"><div class="pl-2 text-bold">Accounting</div><div class="dropdown-divider"></div><a class="dropdown-item small" href="/accounting/account">01. Account</a><div class="dropdown-divider"></div><a class="dropdown-item small" href="/accounting/journal">02. Journal</a><a class="dropdown-item small" href="/accounting/profitloss">03. Profit/Loss</a><a class="dropdown-item small" href="/accounting/balancesheet">04. Balance Sheet</a><div class="dropdown-divider"></div><a class="dropdown-item small" href="/accounting/soppurchase">05. Purchase</a><a class="dropdown-item small" href="/accounting/sopproject">06. Project</a><a class="dropdown-item small" href="/accounting/sopopname">07. Opname</a><a class="dropdown-item small" href="/accounting/sopcashbond">08. Cashbond</a></div></li><li class="nav-item dropdown"><a title="Finance" class="nav-link" data-toggle="dropdown" href="#"><i class="fa fa-money-bill"></i></a><div class="dropdown-menu"><div class="pl-2 text-bold">Finance</div><div class="dropdown-divider"></div><a class="dropdown-item small" href="/finance/purchase">01. Purchase</a><a class="dropdown-item small" href="/finance/purchasepayment">02. Purchase Payment</a><div class="dropdown-divider"></div><a class="dropdown-item small" href="/finance/project">03. Project</a><a class="dropdown-item small" href="/finance/projectpayment">04. Payment</a><div class="dropdown-divider"></div><a class="dropdown-item small" href="/finance/projectstaff">05. Staff</a><a class="dropdown-item small" href="/finance/projectstaffpayment">06. Payment</a><div class="dropdown-divider"></div><a class="dropdown-item small" href="/finance/receive">07. Receive</a><a class="dropdown-item small" href="/finance/cost">08. Cost</a><div class="dropdown-divider"></div><a class="dropdown-item small" href="/finance/cashbond">09. Cashbond</a><a class="dropdown-item small" href="/finance/cashbondpayment">10. Cashbond Payment</a></div></li><li class="nav-item dropdown"><a title="Purchase" class="nav-link" data-toggle="dropdown" href="#"><i class="fa fa-luggage-cart"></i></a><div class="dropdown-menu"><div class="pl-2 text-bold">Purchase</div><div class="dropdown-divider"></div><a class="dropdown-item small" href="/purchase/itemcategory">01. Category</a><a class="dropdown-item small" href="/purchase/unit">02. Unit</a><div class="dropdown-divider"></div><a class="dropdown-item small" href="/purchase/item">03. Item</a><a class="dropdown-item small" href="/purchase/supplier">04. Suplier</a><div class="dropdown-divider"></div><a class="dropdown-item small" href="/purchase/purchase">05. Purchase</a></div></li><li class="nav-item dropdown"><a title="Warehouse" class="nav-link" data-toggle="dropdown" href="#"><i class="fa fa-cube"></i></a><div class="dropdown-menu"><div class="pl-2 text-bold">Warehouse</div><div class="dropdown-divider"></div><a class="dropdown-item small" href="/warehouse/purchasedetail">01. Purchase</a><a class="dropdown-item small" href="/warehouse/receive">02. Stock In</a><div class="dropdown-divider"></div><a class="dropdown-item small" href="/warehouse/receivedetail">03. Receive</a><a class="dropdown-item small" href="/warehouse/return">04. Return</a><div class="dropdown-divider"></div><a class="dropdown-item small" href="/warehouse/projectitem">05. Project</a><a class="dropdown-item small" href="/warehouse/projectdelivery">06. Stock Out</a><div class="dropdown-divider"></div><a class="dropdown-item small" href="/warehouse/item">07. Item</a><a class="dropdown-item small" href="/warehouse/opname">08. Opname</a><div class="dropdown-divider"></div><a class="dropdown-item small" href="/warehouse/stock">09. Stock</a><a class="dropdown-item small" href="/warehouse/history">10. History</a></div></li><li class="nav-item dropdown"><a title="Admin" class="nav-link" data-toggle="dropdown" href="#"><i class="fa fa-calculator"></i></a><div class="dropdown-menu"><div class="pl-2 text-bold">Admin</div><div class="dropdown-divider"></div><a class="dropdown-item small" href="/admin/staff">01. Staff</a><a class="dropdown-item small" href="/admin/job">02. Job</a><div class="dropdown-divider"></div><a class="dropdown-item small" href="/admin/item">03. Item</a><div class="dropdown-divider"></div><a class="dropdown-item small" href="/admin/template">04. Template</a></div></li><li class="nav-item dropdown"><a title="Marketing" class="nav-link" data-toggle="dropdown" href="#"><i class="fa fa-phone"></i></a><div class="dropdown-menu"><div class="pl-2 text-bold">Marketing</div><div class="dropdown-divider"></div><a class="dropdown-item small" href="/marketing/customer">01. Customer</a><a class="dropdown-item small" href="/marketing/vehicle">02. Vehicle</a><div class="dropdown-divider"></div><a class="dropdown-item small" href="/marketing/item">03. Item</a><a class="dropdown-item small" href="/marketing/template">04. Template</a><div class="dropdown-divider"></div><a class="dropdown-item small" href="/marketing/project">05. Project</a></div></li></ul>
    <ul class="navbar-nav ml-auto pr-2">
        <li id="box_usermessage" class="nav-item dropdown"></li>
        <li id="box_usernotification" class="nav-item dropdown"></li>
    </ul>
</nav>            
            <div class="content-wrapper" style="min-height: 282.812px;">
    <div class="content-header">
        <div class="container-fluid">
            <div class="row mb-0">
                <div class="col-sm-6"><h1 id="_caption">Project Payment</h1></div>
                <div class="col-sm-6">
                    <ol class="breadcrumb float-sm-right">
                        <li class="breadcrumb-item" id="_module">Finance</li>
                        <li class="breadcrumb-item" id="_title">Project Payment</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>

    <section class="content">
        <div class="container-fluid">
            <div class="card shadow shadow-lg mt-0">
                <div class="card-body">
                    <div class="row">
                        <div class="col-sm-12">
                            <a class="btn btn-sm btn-info" href="/finance/project"><i class="fa fa-arrow-left"></i></a>
                            <span class="float-right text-bold" id="_event">Add</span>
                            <hr>
                        </div>
                    </div>
                    <div class="row mt-2">
                        <div class="col-sm-12">
                            <form id="frm" class="form-horizontal small">
                                <input type="hidden" id="txt_tID" name="data[tID]" value="ZTJjNGYwMzQ3MjMwMjU3MWMyMzQ3YzkwMGNjMjg2ZmNmOTY1ZmRhYjQ3YjM3MmRjMTUyMmU5NjBlZDM5MzdjMg==">
                                <input type="hidden" id="txt_customer_id" name="data[customer_id]" value="37693cfc748049e45d87b8c7d8b9aacd">
                                <input type="hidden" id="txt_id" name="data[id]" value="d4984599cf89ce6dc82c2a91ac24eb8c">

                                <div class="row">
                                    <div class="col-sm-3">
                                        <label id="lbl_code">#</label>
                                        <input type="text" class="form-control form-control-sm" id="txt_code" disabled="">
                                    </div>
                                    <div class="col-sm-3">
                                        <label id="lbl_date">Date</label>
                                        <input type="date" class="form-control form-control-sm" id="txt_date" name="data[date]">
                                    </div>
                                    <div class="col-sm-3">
                                        <label id="lbl_customer">Customer</label>
                                        <div class="input-group input-group-sm">
                                            <input type="text" class="form-control form-control-sm" id="txt_customer_name" disabled="">
                                        </div>
                                    </div>
                                </div>
                                <div class="row mt-2">
                                    <div class="col-sm-12" id="box_temp"><form id="frmTemp" class="form-horizontal">
    <input type="hidden" id="temp_tID" name="data[tID]" value="ZTJjNGYwMzQ3MjMwMjU3MWMyMzQ3YzkwMGNjMjg2ZmNmOTY1ZmRhYjQ3YjM3MmRjMTUyMmU5NjBlZDM5MzdjMg==">
    <input type="hidden" id="temp_id" name="data[id]" value="30f909f3461db9a644b5495263aa8c0d">
    <input type="hidden" id="temp_projectpayment_id" name="data[projectpayment_id]" value="d4984599cf89ce6dc82c2a91ac24eb8c">

    <div class="table-responsive">
        <table class="table table-bordered table-hover text-nowrap">
            <thead>
                <tr class="bg-gray">
                    <th class="th-code2" id="th_code">Code</th>
                    <th id="th_date">Date</th>
                    <th id="th_vehicle">Vehicle</th>
                    <th class="th-total2" id="th_taxes">Tax#1</th>
                    <th class="th-total2" id="th_taxes2">Tax#2</th>
                    <th class="th-total2" id="th_total">Total</th>
                    <th class="th-payment2" id="th_payment">Payment</th>
                    <th class="th-action1">&nbsp;</th>
                </tr>
                <tr>
                    <td>
                        <input type="hidden" class="form-control form-control-sm" id="temp_project_id" name="data[project_id]" value="">
                        <div class="input-group input-group-sm">
                            <input type="text" class="form-control form-control-sm" id="temp_project_code" disabled="">
                            <span class="input-group-append">
                                <button type="button" id="btn_list" onclick="showProject(); return false;" class="btn bg-gray btn-flat" data-toggle="modal" data-target="#box_modal">...</button>
                            </span>
                        </div>
                    </td>
                    <td><input type="text" class="form-control form-control-sm" id="temp_project_date" disabled=""></td>
                    <td><input type="text" class="form-control form-control-sm" id="temp_project_vehicle" disabled=""></td>
                    <td>
                        <input type="text" class="form-control form-control-sm text-right" id="temp_show_taxes">
                        <input type="hidden" id="temp_txt_taxes" name="data[taxes]" value="0">
                        <script>
                            $('#temp_show_taxes').focus(function () {
                                if ($.isNumeric($('#temp_txt_taxes').val()) && $('#temp_txt_taxes').val() != 0) {
                                    $('#temp_show_taxes').val($('#temp_txt_taxes').val());
                                } else
                                    $('#temp_show_taxes').val('');
                            });
                            $('#temp_show_taxes').keyup(function () {
                                $('#temp_txt_taxes').val($('#temp_show_taxes').val());
                                if (!$.isNumeric($('#temp_txt_taxes').val()))
                                    $('#temp_txt_taxes').val(0);
                            });
                            $('#temp_show_taxes').blur(function () {
                                $('#temp_show_taxes').val(_numberFormat($('#temp_txt_taxes').val(), 4));
                            });
                        </script>
                    </td>
                    <td>
                        <input type="text" class="form-control form-control-sm text-right" id="temp_show_taxes2">
                        <input type="hidden" id="temp_txt_taxes2" name="data[taxes2]" value="0">
                        <script>
                            $('#temp_show_taxes2').focus(function () {
                                if ($.isNumeric($('#temp_txt_taxes2').val()) && $('#temp_txt_taxes2').val() != 0) {
                                    $('#temp_show_taxes2').val($('#temp_txt_taxes2').val());
                                } else
                                    $('#temp_show_taxes2').val('');
                            });
                            $('#temp_show_taxes2').keyup(function () {
                                $('#temp_txt_taxes2').val($('#temp_show_taxes2').val());
                                if (!$.isNumeric($('#temp_txt_taxes2').val()))
                                    $('#temp_txt_taxes2').val(0);
                            });
                            $('#temp_show_taxes2').blur(function () {
                                $('#temp_show_taxes2').val(_numberFormat($('#temp_txt_taxes2').val(), 4));
                            });
                        </script>
                    </td>
                    <td>
                        <input type="text" class="form-control form-control-sm text-right" id="temp_show_total" disabled="">
                        <input type="hidden" id="temp_txt_total" name="data[total]" value="0">
                    </td>
                    <td>
                        <input type="text" class="form-control form-control-sm" id="temp_show_payment">
                        <input type="hidden" id="temp_txt_payment" name="data[payment]" value="0">
                        <script>
                            $('#temp_show_payment').focus(function () {
                                if ($.isNumeric($('#temp_txt_payment').val()) && $('#temp_txt_payment').val() != 0) {
                                    $('#temp_show_payment').val($('#temp_txt_payment').val());
                                } else
                                    $('#temp_show_payment').val('');
                            });
                            $('#temp_show_payment').keyup(function () {
                                $('#temp_txt_payment').val($('#temp_show_payment').val());
                                if (!$.isNumeric($('#temp_txt_payment').val()))
                                    $('#temp_txt_payment').val(0);
                            });
                            $('#temp_show_payment').blur(function () {
                                $('#temp_show_payment').val(_numberFormat($('#temp_txt_payment').val(), 4));
                            });
                        </script>
                    </td>
                    <td><button type="submit" class="btn btn-sm btn-danger"><i class="fa fa-plus"></i></button></td>
                </tr>
            </thead>
            <tbody id="temp_list"></tbody>
        </table>
    </div>
</form>
<script>
    $(document).ready(function () { 
        $('#th_code').html(_PROJECTCODE);
        $('#th_date').html(_DATE);
        $('#th_vehicle').html(_VEHICLE);
        $('#th_taxes').html(_TAX + '#1');
        $('#th_taxes2').html(_TAX + '#2');
        $('#th_total').html(_TOTAL);
        $('#th_payment').html(_PAYMENT);
        
        $('#temp_projectpayment_id').val($('#txt_id').val());
        
        tempLoading();
    });
    
    function tempLoading() {
        $.ajax({
            url: '/finance/api_projectpaymenttemp', type: 'post', dataType: 'json', data: {'tID': localStorage.getItem('tID'), 'projectpayment_id': $('#txt_id').val()},
            success: function (_json) {
                if (_json.status == 1) {
                    $('#temp_tID').val(localStorage.getItem('tID'));
                    $('#temp_id').val(_json.temp_id);
                    resetProject();
                    
                    $('#temp_list').html('');
                    _total = 0;
                    _taxes = 0;
                    _taxes2 = 0;
                    $.each(_json.data, function (_i, _arr) {
                        _total+=parseFloat(_arr.payment);
                        _taxes+=parseFloat(_arr.taxes);
                        _taxes2+=parseFloat(_arr.taxes2);
                        
                        _html = '<tr>';
                        _html+= '<td>' + _arr.project_code + '</td>';
                        _html+= '<td>' + _arr.project_date + '</td>';
                        _html+= '<td>' + _arr.vehicle_name + ' | ' + _arr.vehicle_police + '</td>';
                        _html+= '<td class="text-right">' + _numberFormat(_arr.taxes, 4) + '</td>';
                        _html+= '<td class="text-right">' + _numberFormat(_arr.taxes2, 4) + '</td>';
                        _html+= '<td class="text-right">' + _numberFormat(_arr.total, 4) + '</td>';
                        _html+= '<td class="text-right">' + _numberFormat(_arr.payment, 4) + '</td>';
                        _html+= '<td class="small">';
                        _html+= '<button class="btn btn-sm btn-danger" onclick="tempDelete(\'' + _arr.id + '\'); return false;">';
                        _html+= '<i class="fa fa-minus fa-sm"></i>';
                        _html+= '</button>';
                        _html+= '</td>';
                        _html+= '</tr>';
                        $('#temp_list').append(_html);
                    });
                    $('#show_total').val(_numberFormat(_total, 4));
                    $('#txt_total').val(_total);
                    $('#show_taxes').val(_numberFormat(_taxes, 4));
                    $('#txt_taxes').val(_taxes);
                    $('#show_taxes2').val(_numberFormat(_taxes2, 4));
                    $('#txt_taxes2').val(_taxes2);
                    _calculatePayment();
                    
                    $('#btn_list').focus();
                }
            }
        });
    }
    
    function resetProject(){
        $('#temp_project_id').val('');
        $('#temp_project_code').val('');
        $('#temp_project_date').val('');
        $('#temp_project_vehicle').val('');
        $('#temp_show_taxes').val('0');
        $('#temp_txt_taxes').val('0');
        $('#temp_show_taxes2').val('0');
        $('#temp_txt_taxes2').val('0');
        $('#temp_show_total').val('0');
        $('#temp_txt_total').val('0');
        $('#temp_show_payment').val(0);
        $('#temp_txt_payment').val(0);
    }
    
    function showProject() {
        resetProject();
        $("#modal_list").html('');
        $("#modal_list").load('/finance/projectpayment_project');
    }
    
    function searchProject() {
        if($('#temp_project_id').val()){
            $.ajax({
                url: "/finance/api_projectpayment_project_search", type: "POST",
                dataType: "json", data: {'tID': localStorage.getItem('tID'), 'id': $('#temp_project_id').val()},
                success: function (_json) {
                    if (_json.status == 1) {
                        $('#temp_project_code').val(_json.data.code);
                        $('#temp_project_date').val(_json.data.date);
                        $('#temp_project_vehicle').val(_json.data.vehicle_name + ' | ' + _json.data.vehicle_police);
                        $('#temp_show_taxes').val(_numberFormat(_json.data.taxes, 4));
                        $('#temp_txt_taxes').val(_json.data.taxes);
                        $('#temp_show_taxes2').val(_numberFormat(_json.data.taxes2, 4));
                        $('#temp_txt_taxes2').val(_json.data.taxes2);
                        $('#temp_show_total').val(_numberFormat(_json.data.balance, 4));
                        $('#temp_txt_total').val(_json.data.balance);
                        $('#temp_show_total').val(_numberFormat(_json.data.balance, 4));
                        $('#temp_txt_total').val(_json.data.balance);
                        $('#temp_show_payment').val(_numberFormat(_json.data.balance, 4));
                        $('#temp_txt_payment').val(_json.data.balance);
                        $('#temp_show_payment').focus();
                    }
                }
            });
            return false;
        }
    }
    function tempDelete(_id) {
        Swal.fire({
            title: _DELETEQUESTION, confirmButtonText: _OK, confirmButtonColor: '#f00', cancelButtonText: _CANCEL, cancelButtonColor: '#557', showCancelButton: true, position: 'top', toast: true, background: '#fee'
        }).then((_confirm) => {
            if (_confirm.value) {
                $.ajax({
                    url: '/finance/api_projectpaymenttemp_delete', type: 'post', dataType: 'json', data: {'tID': localStorage.getItem('tID'), 'id': _id},
                    success: function (_json) {
                        if (_json.status == 1) { _msgSuccess(_DELETED); tempLoading(); }
                        else _msgError(_FAILED);
                    }
                });
            }
        });
        return false;
    }
    $('#frmTemp').submit(function () {
        _msg = '';
        if ($('#temp_txt_payment').val() == '0') _msg += _PAYMENTEMPTY + '<br>';
        if (_msg) { $('#box_message').html(_msg); setTimeout(function () { $('#box_message').html(''); }, _APPLOADING); }
        else {
            $.ajax({
                url: '/finance/api_projectpaymenttemp_save', type: 'post', dataType: 'json', data: $(this).serialize(),
                success: function (_json) { if (_json.status == 1) tempLoading(); }
            });
        }
        return false;
    });
</script></div>
                                </div>
                                <div class="row mt-0">
                                    <div class="col-sm-12">
                                        <div class="table-responsive">
                                            <table class="table">
                                                <tbody><tr>
                                                    <td colspan="3" class="text-bold text-right" id="lbl_total">Total</td>
                                                    <td class="th-total2">
                                                        <input type="text" class="form-control form-control-sm text-right" id="show_total" disabled="">
                                                        <input type="hidden" id="txt_total" name="data[total]" value="0">
                                                    </td>
                                                    <td class="th-action1">&nbsp;</td>
                                                </tr>
                                                <tr>
                                                    <td colspan="3" class="text-bold text-right">Tax #1</td>
                                                    <td class="th-total2">
                                                        <input type="text" class="form-control form-control-sm text-right" id="show_taxes" disabled="">
                                                        <input type="hidden" id="txt_taxes" name="data[taxes]" value="0">
                                                    </td>
                                                    <td class="th-action1">&nbsp;</td>
                                                </tr>
                                                <tr>
                                                    <td colspan="3" class="text-bold text-right">Tax #2</td>
                                                    <td class="th-total2">
                                                        <input type="text" class="form-control form-control-sm text-right" id="show_taxes2" disabled="">
                                                        <input type="hidden" id="txt_taxes2" name="data[taxes2]" value="0">
                                                    </td>
                                                    <td class="th-action1">&nbsp;</td>
                                                </tr>
                                                <tr>
                                                    <td colspan="3" class="text-bold text-right" id="lbl_cost">Cost</td>
                                                    <td class="th-total2">
                                                        <input type="text" class="form-control form-control-sm text-right" id="show_cost">
                                                        <input type="hidden" id="txt_cost" name="data[cost]" value="0">
                                                        <script>
                                                            $('#show_cost').focus(function () {
                                                                if ($.isNumeric($('#txt_cost').val()) && $('#txt_cost').val() != 0) {
                                                                    $('#show_cost').val($('#txt_cost').val());
                                                                } else
                                                                    $('#show_cost').val('');
                                                            });
                                                            $('#show_cost').keyup(function () {
                                                                $('#txt_cost').val($('#show_cost').val());
                                                                if (!$.isNumeric($('#txt_cost').val())) $('#txt_cost').val(0);
                                                                _calculatePayment()
                                                            });
                                                            $('#show_cost').blur(function () {
                                                                $('#show_cost').val(_numberFormat($('#txt_cost').val(), 4));
                                                                _calculatePayment()
                                                            });
                                                            
                                                            function _calculatePayment(){
                                                                _total = parseFloat($('#txt_total').val());
                                                                _taxes = parseFloat($('#txt_taxes').val());
                                                                _taxes2 = parseFloat($('#txt_taxes2').val());
                                                                _cost = parseFloat($('#txt_cost').val());
                                                                _discount = parseFloat($('#txt_discount').val());
                                                                _payment = _total - _taxes - _taxes2 - _cost - _discount;
                                                                
                                                                $('#show_payment').val(_numberFormat(_payment, 4));
                                                            }
                                                        </script>
                                                    </td>
                                                    <td class="th-action1">&nbsp;</td>
                                                </tr>
                                                <tr>
                                                    <td colspan="3" class="text-bold text-right" id="lbl_discount">Discount</td>
                                                    <td class="th-total2">
                                                        <input type="text" class="form-control form-control-sm text-right" id="show_discount">
                                                        <input type="hidden" id="txt_discount" name="data[discount]" value="0">
                                                        <script>
                                                            $('#show_discount').focus(function () {
                                                                if ($.isNumeric($('#txt_discount').val()) && $('#txt_discount').val() != 0) {
                                                                    $('#show_discount').val($('#txt_discount').val());
                                                                } else
                                                                    $('#show_discount').val('');
                                                            });
                                                            $('#show_discount').keyup(function () {
                                                                $('#txt_discount').val($('#show_discount').val());
                                                                if (!$.isNumeric($('#txt_discount').val())) $('#txt_discount').val(0);
                                                                _calculatePayment()
                                                            });
                                                            $('#show_discount').blur(function () {
                                                                $('#show_discount').val(_numberFormat($('#txt_discount').val(), 4));
                                                                _calculatePayment()
                                                            });
                                                        </script>
                                                    </td>
                                                    <td class="th-action1">&nbsp;</td>
                                                </tr>
                                                <tr>
                                                    <td class="text-bold text-right" id="lbl_account">Account</td>
                                                    <td>
                                                        <select id="txt_account_id" name="data[account_id]" class="form-control form-control-sm"><option value="e4db4fc1ef9ae443ced49d00f2192445">11101 - Kas Kecil</option><option value="52c4608c2f126708211b9e0a60eaf050">11102 - Kas Besar</option><option value="fb25b181bed28630afa6c026a6ed31fe">11106 - Kas Pemilik</option><option value="dc1d3cb9517bda57aacd65f5b1986c6e">11201 - Bank BCA CV</option><option value="fe998b49c41c4208c968bce204fa1cbb">11202 - Bank Mandiri CV</option><option value="44f9537edcc4c4065a1bf6062317026a">11203 - Bank BCA Handoko</option><option value="99f8339daa3af68c61f1eaa734f16561">11204 - Bank BRI</option><option value="444e1948854f9a50730f1a6da6b89251">11205 - Giro Mandiri</option><option value="45f17bfcfd539631fb7ab14f99de1f10">11206 - Konsumen Pemerintah</option></select>
                                                    </td>
                                                    <td class="text-bold text-right" id="lbl_payment">Payment</td>
                                                    <td class="th-total2">
                                                        <input type="text" class="form-control form-control-sm text-right" id="show_payment" disabled="">
                                                    </td>
                                                    <td class="th-action1">&nbsp;</td>
                                                </tr>
                                            </tbody></table>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-3">
                                        <label id="lbl_datedue">Datedue</label>
                                        <input type="date" class="form-control form-control-sm" id="txt_datedue" name="data[datedue]">
                                    </div>
                                    <div class="col-sm-3">
                                        <label id="lbl_notes">Notes</label>
                                        <input type="text" class="form-control form-control-sm" id="txt_notes" name="data[notes]">
                                    </div>
                                </div>
                                <button type="submit" class="btn btn-sm btn-dark mt-2" id="_btn">Save</button>
                            </form>
                            <div class="text-danger text-sm mt-2" id="box_message"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>
<div class="modal fade" id="box_modal" style="display: none;" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content bg-gray-light p-1" id="modal_list"><div class="modal-header bg-gray">
    <h5 class="modal-title" id="list_caption">Project</h5>
    <button class="close" data-dismiss="modal" aria-label="Close" id="btn_close">
        <span aria-hidden="true">×</span>
    </button>
</div>
<div class="modal-body">
    <form id="frmList" role="form" class="form-inline">
        <input type="hidden" id="list_tID" name="data[tID]" value="ZTJjNGYwMzQ3MjMwMjU3MWMyMzQ3YzkwMGNjMjg2ZmNmOTY1ZmRhYjQ3YjM3MmRjMTUyMmU5NjBlZDM5MzdjMg==">
        <input type="hidden" id="list_customer_id" name="data[customer_id]" value="37693cfc748049e45d87b8c7d8b9aacd">
    </form>
    <div class="row mt-2">
        <div class="col-sm-12">
            <div class="table-responsive">
                <table class="table small table-bordered table-hover text-nowrap m-0">
                    <thead class="bg-gray">
                        <tr>
                            <th class="th-code" id="th_project_code">Project#</th>
                            <th class="th-code" id="th_code"></th>
                            <th class="th-date" id="th_date"></th>
                            <th id="th_customer">Customer</th>
                            <th id="th_vehicle"></th>
                            <th class="th-date" id="th_datedue">Datedue</th>
                            <th class="th-total" id="th_total"></th>
                            <th class="th-payment" id="th_payment"></th>
                            <th class="th-balance" id="th_balance">Balance</th>
                            <th class="th-action1"></th>
                        </tr>
                    </thead>
                    <tbody id="_list"><tr><td>TPRO22021700001</td><td>undefined</td><td>17-Feb-22</td><td>WIDODO</td><td>E 8812 AQ | E 8812 AQ</td><td>17-Feb-22</td><td class="text-right">9,950,000.0000</td><td class="text-right">0.0000</td><td class="text-right bg-danger">9,950,000.0000</td><td class="small"><button class="btn btn-sm btn-warning" onclick="pickList('2341a38ef1ccc6da349f2acf6e6ae17e'); return false;">&lt;&lt;</button></td></tr><tr><td>TPRO22021800001</td><td>undefined</td><td>18-Feb-22</td><td>WIDODO</td><td>Hino | </td><td>18-Feb-22</td><td class="text-right">1,750,000.0000</td><td class="text-right">600,000.0000</td><td class="text-right bg-danger">1,150,000.0000</td><td class="small"><button class="btn btn-sm btn-warning" onclick="pickList('cc2dc20010a1aa5b2e2274a882a62622'); return false;">&lt;&lt;</button></td></tr></tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<script>
    $(document).ready(function () {
        $('#list_caption').html(_PROJECT);
        $('#th_project_code').html(_PROJECTCODE);
        $('#th_code').html(_CODE);
        $('#th_date').html(_DATE);
        $('#th_customer').html(_CUSTOMER);
        $('#th_vehicle').html(_VEHICLE);
        $('#th_datedue').html(_DATEDUE);
        $('#th_total').html(_TOTAL);
        $('#th_payment').html(_PAYMENT);
        $('#th_balance').html(_BALANCE);
        
        $('#list_tID').val(localStorage.getItem('tID'));
        $('#list_customer_id').val($('#txt_customer_id').val());
        listChange();
    });

    function listChange() { $('#frmList').submit(); }

    $('#frmList').submit(function () {
        $.ajax({
            url: "/finance/api_projectpayment_project", type: "post", dataType: "json", data: $(this).serialize(),
            success: function (_json) {
                if (_json.status == 1) {
                    $('#_list').html('');
                    $.each(_json.data, function (_i, _arr) {
                        _html= '<tr>';
                        _html+= '<td>' + _arr.code + '</td>';
                        _html+= '<td>' + _arr.code2 + '</td>';
                        _html+= '<td>' + _arr.date + '</td>';
                        _html+= '<td>' + _arr.customer_name + '</td>';
                        _html+= '<td>' + _arr.vehicle_name + ' | ' + _arr.vehicle_police + '</td>';
                        _html+= '<td>' + _arr.datedue + '</td>';
                        _html+= '<td class="text-right">' + _numberFormat(_arr.total, 4) + '</td>';
                        _html+= '<td class="text-right">' + _numberFormat(_arr.payment, 4) + '</td>';
                        _html+= '<td class="text-right bg-danger">' + _numberFormat(_arr.balance, 4) + '</td>';
                        _html+= '<td class="small">';
                        _html+= '<button class="btn btn-sm btn-warning" onclick="pickList(\'' + _arr.id + '\'); return false;">';
                        _html+= '<<';
                        _html+= '</button>';
                        _html+= '</td>';
                        _html+= '</tr>';
                        $('#_list').append(_html);
                    });
                }
            }
        });
        return false;
    });

    function pickList(_id) {
        $('#temp_project_id').val(_id);
        searchProject();
        $('#btn_close').click();
    }
</script></div>
    </div>
</div>
<script>
    $(document).ready(function () {
        localStorage.setItem('router', '/finance/projectpayment_add');
        ajaxLoading();
    });

    function pageControll() {
        $.ajax({
            url: '/finance/api_projectpayment_add', type: 'post', dataType: 'json', data: {'tID': localStorage.getItem('tID'), 'customer_id': localStorage.getItem('_id')},
            success: function (_json) {
                if (_json.status == 1) {
                    $('#_body').show();
                    $('#_caption').html(_PROJECTPAYMENT);
                    $('#_module').html(_FINANCE);
                    $('#_title').html(_PROJECTPAYMENT);
                    $('#_event').html(_ADD);

                    $('#lbl_code').html('#');
                    $('#lbl_date').html(_DATE);
                    $('#lbl_customer').html(_CUSTOMER);
                    $('#lbl_datedue').html(_DATEDUE);
                    $('#lbl_notes').html(_NOTES);
                    $('#lbl_total').html(_TOTAL);
                    $('#lbl_cost').html(_COST);
                    $('#lbl_discount').html(_DISCOUNT);
                    $('#lbl_payment').html(_PAYMENT);
                    $('#lbl_account').html(_ACCOUNT);
                    $('#_btn').html(_SAVE);
                    
                    $('#txt_account_id').html('');
                    $.each(_json._account, function (_i, _arr) {
                        _html = '<option value="' + _arr.id + '">' + _arr.code + ' - ' + _arr.name + '</option>';
                        $('#txt_account_id').append(_html);
                    });

                    $('#txt_tID').val(localStorage.getItem('tID'));
                    $('#txt_customer_id').val(_json.data.customer_id);
                    $('#txt_id').val(_json.data.id);
                    $('#txt_code').val(_AUTO);
                    $('#txt_date').val(_json.data.date);
                    $('#txt_customer_name').val(_json.data.customer_name);
                    $('#txt_datedue').val(_json.data.datedue);
                    $('#show_cost').val('0.0000');
                    $('#txt_cost').val(0);
                    $('#show_discount').val('0.0000');
                    $('#txt_discount').val(0);

                    $("#box_temp").load('/finance/projectpaymenttemp');
                }
            }
        });
    }

    $('#frm').submit(function () {
        _msg = '';
        if ($('#txt_total').val() == '0') _msg += _TOTALEMPTY + '<br>';
        if (_msg) {
            $('#box_message').html(_msg); setTimeout(function () { $('#box_message').html(''); }, _APPLOADING);
        } else {
            $.ajax({
                url: '/finance/api_projectpayment_save', type: 'post', dataType: 'json', data: $(this).serialize(),
                success: function (_json) {
                    if (_json.status == 1) {
                        $('#box_message').html(_SAVED);
                        setTimeout(function () {
                            window.location = '/finance/projectpayment';
                        }, _APPLOADING);
                    } else {
                        $('#box_message').html(_FAILED);
                        setTimeout(function () {
                            $('#box_message').html('');
                        }, _APPLOADING);
                    }
                }
            });
        }
        return false;
    });
</script>
            <footer class="main-footer bg-gradient-dark small">
            </footer>

            <aside class="control-sidebar control-sidebar-dark">
                <!-- Control sidebar content goes here -->
            </aside>

        </div>